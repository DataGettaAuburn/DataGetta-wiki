<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Deploying New Changes to Production - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../About-SSH/" class="nav-link">About-SSH</a>
                            </li>
                            <li class="nav-item">
                                <a href="../App-Folder/" class="nav-link">App-Folder</a>
                            </li>
                            <li class="nav-item">
                                <a href="../App-Setup/" class="nav-link">App-Setup</a>
                            </li>
                            <li class="nav-item">
                                <a href="../CAS-setup-for-datagetta/" class="nav-link">CAS-setup-for-datagetta</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#deploying-new-changes-to-production" class="nav-link">Deploying New Changes to Production</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#self-hosted-runner-overview" class="nav-link">Self Hosted Runner Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#secrets" class="nav-link">Secrets</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#deployment-triggers" class="nav-link">Deployment Triggers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="deploying-new-changes-to-production">Deploying New Changes to Production</h1>
<p>With the newly deployed production environment, we have successfully setup a Github Self-Hosted Runner on the OIT provided VM such that with every PR that is merged or change pushed to <code>main</code> a our actions script is triggered.</p>
<h2 id="self-hosted-runner-overview">Self Hosted Runner Overview</h2>
<p>By using a <a href="https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners">Self-Hosted Runner</a>, we avoid the minute limitations and potential costs that are associated with GitHub runners, by leveraging the Ubuntu server that we have been provided with. The current runner is connected to the account of <a href="https://github.com/tyler-teufel">tyler-teufel</a> at the time of the writing of this document, and is directly connected to this repository. For instructions on how this Self Hosted Runner was setup, see the following:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=aLHyPZO0Fy0">Youtube Tutorial</a></li>
<li><a href="https://gist.github.com/devinschumacher/c503cead206d4992d1a3cbb03c95e4c9">GitHub Gist Tutorial Post</a></li>
</ul>
<p>Following the following tutorials can provide some insight into how everything is setup.</p>
<h2 id="secrets">Secrets</h2>
<p>In terms of the secrets that are traditionally utilized within a <code>.env</code> file for local development, we store them within the actions secrets within the repository. If you navigate to the repository settings and head to the 'secrets &amp; variables' tab, and then select 'actions', you can add or modify any secrets needed.</p>
<p>The secrets are then routed utilizing injection code within both the <code>production.yml</code> actions script, as well as the <code>docker-compose.yaml</code> file. These secrets are first accessed from the repository using <code>secrets.SECRET_NAME</code> under the <code>env:</code> section of the actions script. To ensure these variables can be used within all run steps, inject this within the <code>deploy:</code> section right after the line showing <code>runs-on: self-hosted</code>. Doing this allows for each subsequent job to have access the all of the variables within the environment itself. From here, think of the variables as being injected at runtime into the project environment.</p>
<p>The next step is to inject these into the <code>docker-compose.yaml</code> file. Due to the way Docker is setup, it automatically tries to look for a .env file in the environment for the secrets. Since there is not one in this setup, we need to utilize an intuitive workaround that does not intervene with our <code>docker-compose.override.yaml</code> file we use for local development. This can be done by creating a section within the <code>docker-compose.yaml</code> file called <code>x-common-env</code> that would contain environmental variable injections that can be used as if it were in fact the contents of a <code>.env</code> file.</p>
<p>By including this object within each container using the <code>environment: &lt;&lt;: *common-env</code> syntax in each containers configuration, we successfully allow for these secrets to now exist in the projects environment.</p>
<h2 id="deployment-triggers">Deployment Triggers</h2>
<p>Our current deployment script is configured to act as soon as a PR is successfully merged into the <code>main</code> branch. Currently, for good practice, we have all PRs to <code>main</code> requiring at least one review before allowing them to be merged directly to the branch. We also have added branch protection preventing any deletion of the branch, as well as pushing commit directly to main.</p>
<p>Any commits to <code>main</code> trigger the action to run, which consist of first granting necessary modification permissions to the directory of the project. Next, the docker containers are then confirmed to build. Following this, any existing containers are shut down, followed by the redeployment of the newly modified containers.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
